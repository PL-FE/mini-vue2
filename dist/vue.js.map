{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const oldArrayProto = Array.prototype; // 获取数组原型\r\n\r\nexport const newArrayProto = Object.create(oldArrayProto);\r\n\r\nconst methods = [\r\n  \"push\",\r\n  \"pop\",\r\n  \"shift\",\r\n  \"unshift\",\r\n  \"sort\",\r\n  \"splice\",\r\n  \"reverse\",\r\n];\r\n\r\nmethods.forEach((method) => {\r\n  newArrayProto[method] = function (...args) {\r\n    const result = oldArrayProto[method].apply(this, args); // 内部调用原来的方法\r\n    console.log(\"result\", result);\r\n\r\n    let inserted;\r\n\r\n    switch (method) {\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n      case \"unshift\":\r\n        inserted = args.slice(2);\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (inserted) {\r\n      this.__ob__.observeArray(inserted);\r\n    }\r\n    return result;\r\n  };\r\n});\r\n","import { newArrayProto } from \"./array\";\r\n\r\nclass Observe {\r\n  constructor(data) {\r\n    // Object.defineProperty 只能劫持已经存在的属性\r\n    // data.__ob__ = this; 给数据加了辨识，如果数据有了ob，说明被观察过了\r\n    Object.defineProperty(data, \"__ob__\", {\r\n      value: this,\r\n      enumerable: false, // 不可枚举，防止无限递归\r\n    });\r\n    if (Array.isArray(data)) {\r\n      // 因为数组很少用 list[887]下标，所以为了节省性能，使用数组劫持来进行响应式,\r\n      // 重新给七个变异方法，push\\unshift\\pop\\shift\\reverse\\splice\r\n      data.__proto__ = newArrayProto;\r\n      this.observeArray(data);\r\n    } else {\r\n      this.walk(data);\r\n    }\r\n  }\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\r\n  }\r\n\r\n  observeArray(data) {\r\n    // 劫持数组内的对象\r\n    data.forEach((item) => observe(item));\r\n  }\r\n}\r\n\r\nfunction defineReactive(target, key, value) {\r\n  observe(value); //递归劫持对象\r\n  Object.defineProperty(target, key, {\r\n    get() {\r\n      return value;\r\n    },\r\n    set(newValue) {\r\n      if (newValue === value) {\r\n        return;\r\n      }\r\n      value = newValue;\r\n    },\r\n  });\r\n}\r\nexport function observe(data) {\r\n  if (typeof data !== \"object\" || data == null) {\r\n    return; //只对对象劫持\r\n  }\r\n  if (data.__ob__ instanceof Observe) {\r\n    return data.__ob__;\r\n  }\r\n\r\n  // 如果对象被劫持过了，就不劫持了，可以增添一个实例\r\n  return new Observe(data);\r\n}\r\n","import { observe } from \"./observe/index\";\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options;\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n}\r\n\r\nfunction proxy(vm, taregt, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      console.log(\"取值\");\r\n      return vm[taregt][key];\r\n    },\r\n    set(newValue) {\r\n      console.log(\"设置\");\r\n      vm[taregt][key] = newValue;\r\n    },\r\n  });\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data;\r\n  data = typeof data === \"function\" ? data.call(vm) : data;\r\n  vm._data = data;\r\n  console.log(\"data\", data);\r\n  observe(data);\r\n  //   将vm._data用vm代理\r\n  for (const key in data) {\r\n    proxy(vm, \"_data\", key);\r\n  }\r\n}\r\n","import { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this;\r\n    vm.$options = options;\r\n\r\n    // 初始化状态\r\n    initState(vm);\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n  this._init(options);\r\n}\r\ninitMixin(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","apply","console","log","inserted","slice","__ob__","observeArray","Observe","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","set","newValue","initState","vm","opts","$options","initData","proxy","taregt","call","_data","initMixin","Vue","_init","options"],"mappings":"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"}